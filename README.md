# Анализатор HTTP-логов

Мощная программа на C для анализа лог-файлов HTTP-сервера с использованием регулярных выражений. Этот инструмент поддерживает Common Log Format (CLF) и Combined Log Format, а также пользовательские форматы логов, определенные в JSON-файлах конфигурации.

## Возможности

- Поддержка Common Log Format и Combined Log Format
- Поддержка пользовательских форматов логов через JSON-конфигурацию
- Многопоточная обработка для больших лог-файлов
- Различные аналитические функции:
  - Топ N IP-адресов
  - Топ N URL
  - Распределение HTTP-кодов ответа
  - Топ N User-Agent
  - Фильтрация по IP-адресу или URL
  - Статистика по времени
- Настраиваемые параметры для всех аналитических функций

## Сборка

```bash
make
```

## Использование

```
./log_analyzer [опции]
```

### Опции

- `-f <формат>`: Указать формат лога (common, combined)
- `-l <файл>`: Указать лог-файл для анализа
- `-config <файл>`: Указать файл конфигурации для пользовательского формата лога
- `-topip <n>`: Показать топ N IP-адресов
- `-topurl <n>`: Показать топ N URL
- `-topua <n>`: Показать топ N User-Agent
- `-ip <ip>`: Фильтровать по IP-адресу
- `-url <url>`: Фильтровать по URL
- `-time stats`: Включить статистику по времени
- `-start <дата-время>`: Начальный фильтр времени (формат: YYYY-MM-DD HH:MM:SS)
- `-end <дата-время>`: Конечный фильтр времени (формат: YYYY-MM-DD HH:MM:SS)
- `-h`: Показать справку

### Примеры

Анализ лог-файла с использованием Combined Log Format, показать топ 10 IP и топ 5 URL:

```bash
./log_analyzer -f combined -l access.log -topip 10 -topurl 5
```

Анализ лог-файла с фильтрацией по времени:

```bash
./log_analyzer -f combined -l access.log -time stats -start "2023-10-26 00:00:00" -end "2023-10-26 23:59:59"
```

Использование пользовательского формата лога, определенного в файле конфигурации:

```bash
./log_analyzer -config custom_format.json -l access.log -topip 10
```

## Конфигурация пользовательского формата лога

Пользовательские форматы логов можно определить в JSON-файлах. Пример:

```json
{
  "log_format": "custom",
  "regex": "^(?<ip>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}) - - \\[(?<datetime>.*)\\] \"(?<method>\\w+) (?<url>[^ ]*) HTTP/[0-9\\.]+ \" (?<code>\\d+) (?<size>\\d+) \"(?<referer>[^\"]*)\" \"(?<useragent>[^\"]*)\"$",
  "fields": {
    "ip": "ip",
    "datetime": "datetime",
    "method": "method",
    "url": "url",
    "code": "code",
    "size": "size",
    "referer": "referer",
    "useragent": "useragent"
  }
}
```
